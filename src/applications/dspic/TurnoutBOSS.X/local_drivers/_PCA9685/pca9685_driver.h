/** \copyright
 * Copyright (c) 2024, Jim Kueneman
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *  - Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 *
 *  - Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 *
 * \file pca9685.h
 *
 * @author Jim Kueneman
 * @date 5 April 2025
 */

// This is a guard condition so that contents of this file are not included
// more than once. 
#ifndef __PCA9685__
#define	__PCA9685__

#include "i2c1.h"

#define PCA9685_ALL_CALL_ADDRESS 0b1110000
#define PCA9685_SOFTWARE_RESET_ADDRESS 0b0000011


// Registers
#define PCA9685_MODE1           0x00
#define PCA9685_MODE2           0x01

#define PCA9685_SUBADR1         0x02
#define PCA9685_SUBADR2         0x03
#define PCA9685_SUBADR3         0x04

#define PCA9685_ALLCALLADR      0x05

#define PCA9685_LED0_ON_L_REG   0x06
#define PCA9685_LED0_ON_H_REG   0x07
#define PCA9685_LED0_OFF_L_REG  0x08
#define PCA9685_LED0_OFF_H_REG  0x09

#define PCA9685_LED1_ON_L_REG   0x0A
#define PCA9685_LED1_ON_H_REG   0x0B
#define PCA9685_LED1_OFF_L_REG  0x0C
#define PCA9685_LED1_OFF_H_REG  0x0D

#define PCA9685_LED2_ON_L_REG   0x0E
#define PCA9685_LED2_ON_H_REG   0x0F
#define PCA9685_LED2_OFF_L_REG  0x10
#define PCA9685_LED2_OFF_H_REG  0x11

#define PCA9685_LED3_ON_L_REG   0x12
#define PCA9685_LED3_ON_H_REG   0x13
#define PCA9685_LED3_OFF_L_REG  0x14
#define PCA9685_LED3_OFF_H_REG  0x15

#define PCA9685_LED4_ON_L_REG   0x16
#define PCA9685_LED4_ON_H_REG   0x17
#define PCA9685_LED4_OFF_L_REG  0x18
#define PCA9685_LED4_OFF_H_REG  0x19

#define PCA9685_LED5_ON_L_REG   0x1A
#define PCA9685_LED5_ON_H_REG   0x1B
#define PCA9685_LED5_OFF_L_REG  0x1C
#define PCA9685_LED5_OFF_H_REG  0x1D

#define PCA9685_LED6_ON_L_REG   0x1E
#define PCA9685_LED6_ON_H_REG   0x1F
#define PCA9685_LED6_OFF_L_REG  0x20
#define PCA9685_LED6_OFF_H_REG  0x21

#define PCA9685_LED7_ON_L_REG   0x22
#define PCA9685_LED7_ON_H_REG   0x23
#define PCA9685_LED7_OFF_L_REG  0x24
#define PCA9685_LED7_OFF_H_REG  0x25

#define PCA9685_LED8_ON_L_REG   0x26
#define PCA9685_LED8_ON_H_REG   0x27
#define PCA9685_LED8_OFF_L_REG  0x28
#define PCA9685_LED8_OFF_H_REG  0x29

#define PCA9685_LED9_ON_L_REG   0x2A
#define PCA9685_LED9_ON_H_REG   0x2B
#define PCA9685_LED9_OFF_L_REG  0x2C
#define PCA9685_LED9_OFF_H_REG  0x2D

#define PCA9685_LED10_ON_L_REG   0x2E
#define PCA9685_LED10_ON_H_REG   0x2F
#define PCA9685_LED10_OFF_L_REG  0x30
#define PCA9685_LED10_OFF_H_REG  0x31

#define PCA9685_LED11_ON_L_REG   0x32
#define PCA9685_LED11_ON_H_REG   0x33
#define PCA9685_LED11_OFF_L_REG  0x34
#define PCA9685_LED11_OFF_H_REG  0x35

#define PCA9685_LED12_ON_L_REG   0x36
#define PCA9685_LED12_ON_H_REG   0x37
#define PCA9685_LED12_OFF_L_REG  0x38
#define PCA9685_LED12_OFF_H_REG  0x39

#define PCA9685_LED13_ON_L_REG   0x3A
#define PCA9685_LED13_ON_H_REG   0x3B
#define PCA9685_LED13_OFF_L_REG  0x3C
#define PCA9685_LED13_OFF_H_REG  0x3D

#define PCA9685_LED14_ON_L_REG   0x3E
#define PCA9685_LED14_ON_H_REG   0x3F
#define PCA9685_LED14_OFF_L_REG  0x40
#define PCA9685_LED14_OFF_H_REG  0x41

#define PCA9685_LED15_ON_L_REG   0x42
#define PCA9685_LED15_ON_H_REG   0x43
#define PCA9685_LED15_OFF_L_REG  0x44
#define PCA9685_LED15_OFF_H_REG  0x45

#define PCA9685_ALL_LED_ON_L     0xFA
#define PCA9685_ALL_LED_ON_H     0xFB
#define PCA9685_ALL_LED_OFF_L    0xFC
#define PCA9685_ALL_LED_OFF_H    0xFD

#define PCA9685_PRE_SCALE        0xFE

#define PCA9685_TESTMODE         0xFF

#define PCA9685_MODE1_RESTART_DISABLED_BIT  0b00000000
#define PCA9685_MODE1_RESTART_ENABLED_BIT   0b10000000

#define PCA9685_MODE1_CLOCK_INTERNAL_BIT    0b00000000
#define PCA9685_MODE1_CLOCK_EXTERNAL_BIT    0b01000000

#define PCA9685_MODE1_AUTO_INC_DISABLED_BIT 0b00000000
#define PCA9685_MODE1_AUTO_INC_ENABLED_BIT  0b00100000

#define PCA9685_MODE1_SLEEP_NORMAL_BIT      0b00000000
#define PCA9685_MODE1_SLEEP_LOW_POWER_BIT   0b00010000

#define PCA9685_MODE1_SUBADR1_DISABLED_BIT  0b00000000
#define PCA9685_MODE1_SUBADR1_ENABLED_BIT   0b00001000

#define PCA9685_MODE1_SUBADR2_DISABLED_BIT  0b00000000
#define PCA9685_MODE1_SUBADR2_ENABLED_BIT   0b00000100

#define PCA9685_MODE1_SUBADR3_DISABLED_BIT  0b00000000
#define PCA9685_MODE1_SUBADR3_ENABLED_BIT   0b00000010

#define PCA9685_MODE1_ALL_CALL_DISABLED_BIT 0b00000000
#define PCA9685_MODE1_ALL_CALL_ENABLED_BIT  0b00000001

#define PCA9685_MODE2_INVERT_DISABLED_BIT   0b00000000
#define PCA9685_MODE2_INVERT_ENABLED_BIT    0b00010000

#define PCA9685_MODE2_OUTPUT_UPDATED_ON_STOP_BIT        0b00000000
#define PCA9685_MODE2_OUTPUT_UPDATED_ON_EACH_ACK_BIT    0b00001000

#define PCA9685_MODE2_OPEN_DRAIN_OUTPUTS_BIT   0b00000000
#define PCA9685_MODE2_TOTEM_POLE_OUTPUTS_BIT   0b00000100

#define PCA9685_MODE2_OE_DEFAULT               0b00000000


#define MODE1_DEFAULT PCA9685_MODE1_RESTART_DISABLED_BIT | PCA9685_MODE1_CLOCK_INTERNAL_BIT | PCA9685_MODE1_AUTO_INC_DISABLED_BIT | PCA9685_MODE1_SLEEP_LOW_POWER_BIT | PCA9685_MODE1_SUBADR1_DISABLED_BIT |PCA9685_MODE1_SUBADR2_DISABLED_BIT | PCA9685_MODE1_SUBADR3_DISABLED_BIT | PCA9685_MODE1_ALL_CALL_ENABLED_BIT
#define MODE2_DEFAULT PCA9685_MODE2_INVERT_DISABLED_BIT | PCA9685_MODE2_OUTPUT_UPDATED_ON_STOP_BIT | PCA9685_MODE2_TOTEM_POLE_OUTPUTS_BIT | PCA9685_MODE2_OE_DEFAULT;


#define PCA9685_SIGNAL_ADDRESS 0b0000100


extern i2c_message_t PCA9685_i2c_message;

#ifdef	__cplusplus
extern "C" {
#endif /* __cplusplus */

    extern void PCA9685_initialize(void);

    extern void PCA9685_set_auto_register_increment(uint8_olcb_t do_set);
    
    extern void PCA9685_set_invert_outputs_increment(uint8_olcb_t do_set);
    
    extern void PCA9685_set_prescaler(uint8_olcb_t scaler);

    extern void PCA9685_update_signals(void);
    
    extern void PCA9685_invert_outputs(void);

#ifdef	__cplusplus
}
#endif /* __cplusplus */

#endif	/* __PCA9685__ */

