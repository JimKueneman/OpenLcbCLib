<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenLcbCLib: src/drivers/canbus/can_buffer_store.h File Reference</title>
<link rel="icon" href="Diesel.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">OpenLcbCLib<span id="projectnumber">&#160;1.0 Alpha</span>
   </div>
   <div id="projectbrief">OpenSource C Library to create OpenLcb/Lcc Nodes</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c718a368270b13c54d94892d20736f45.html">drivers</a></li><li class="navelem"><a class="el" href="dir_858afec057d05dde4e87dd686afd4670.html">canbus</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">can_buffer_store.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Pre-allocated pool of <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffers (8-byte payload each).  
<a href="#details">More...</a></p>

<p><a href="can__buffer__store_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a49fcb6055f37edb9e56977295cd0eaf2" id="r_a49fcb6055f37edb9e56977295cd0eaf2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a49fcb6055f37edb9e56977295cd0eaf2">CanBufferStore_initialize</a> (void)</td></tr>
<tr class="memdesc:a49fcb6055f37edb9e56977295cd0eaf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears all buffers and resets telemetry counters.  <br /></td></tr>
<tr class="separator:a49fcb6055f37edb9e56977295cd0eaf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd3358d37ab07ff0f8ec918c00fffe99" id="r_afd3358d37ab07ff0f8ec918c00fffe99"><td class="memItemLeft" align="right" valign="top"><a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afd3358d37ab07ff0f8ec918c00fffe99">CanBufferStore_allocate_buffer</a> (void)</td></tr>
<tr class="memdesc:afd3358d37ab07ff0f8ec918c00fffe99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates one <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffer from the pool.  <br /></td></tr>
<tr class="separator:afd3358d37ab07ff0f8ec918c00fffe99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad95fb1127ec823f0cc9117848b78e5a7" id="r_ad95fb1127ec823f0cc9117848b78e5a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad95fb1127ec823f0cc9117848b78e5a7">CanBufferStore_free_buffer</a> (<a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> *msg)</td></tr>
<tr class="memdesc:ad95fb1127ec823f0cc9117848b78e5a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffer to the pool.  <br /></td></tr>
<tr class="separator:ad95fb1127ec823f0cc9117848b78e5a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a114ce74d1c445b6df687c6148d62d6c6" id="r_a114ce74d1c445b6df687c6148d62d6c6"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a114ce74d1c445b6df687c6148d62d6c6">CanBufferStore_messages_allocated</a> (void)</td></tr>
<tr class="memdesc:a114ce74d1c445b6df687c6148d62d6c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffers currently allocated.  <br /></td></tr>
<tr class="separator:a114ce74d1c445b6df687c6148d62d6c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94cdc3572a78f32c7a31b632b741ff31" id="r_a94cdc3572a78f32c7a31b632b741ff31"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a94cdc3572a78f32c7a31b632b741ff31">CanBufferStore_messages_max_allocated</a> (void)</td></tr>
<tr class="memdesc:a94cdc3572a78f32c7a31b632b741ff31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the peak allocation count since last reset.  <br /></td></tr>
<tr class="separator:a94cdc3572a78f32c7a31b632b741ff31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6eded9ea67c83dfe9fff89a79f36ad6" id="r_ab6eded9ea67c83dfe9fff89a79f36ad6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab6eded9ea67c83dfe9fff89a79f36ad6">CanBufferStore_clear_max_allocated</a> (void)</td></tr>
<tr class="memdesc:ab6eded9ea67c83dfe9fff89a79f36ad6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the peak counter without affecting current allocations.  <br /></td></tr>
<tr class="separator:ab6eded9ea67c83dfe9fff89a79f36ad6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Pre-allocated pool of <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffers (8-byte payload each). </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2024, Jim Kueneman All rights reserved.</dd></dl>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ul>
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<p>Pool size is set at compile time via USER_DEFINED_CAN_MSG_BUFFER_DEPTH. All memory is allocated at startup - no dynamic allocation at runtime. Telemetry counters support pool-size tuning during development.</p>
<dl class="section author"><dt>Author</dt><dd>Jim Kueneman </dd></dl>
<dl class="section date"><dt>Date</dt><dd>28 Feb 2026 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a49fcb6055f37edb9e56977295cd0eaf2" name="a49fcb6055f37edb9e56977295cd0eaf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49fcb6055f37edb9e56977295cd0eaf2">&#9670;&#160;</a></span>CanBufferStore_initialize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CanBufferStore_initialize </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Clears all buffers and resets telemetry counters. </p>
<dl class="section warning"><dt>Warning</dt><dd>Must be called once at startup before any buffer operations. </dd>
<dd>
NOT thread-safe.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="can__buffer__store_8c.html#afd3358d37ab07ff0f8ec918c00fffe99" title="Allocates one can_msg_t buffer from the pool.">CanBufferStore_allocate_buffer</a></dd></dl>
<p>Algorithm:</p><ol type="1">
<li>Iterate through all USER_DEFINED_CAN_MSG_BUFFER_DEPTH entries.</li>
<li>Set allocated flag to false, clear identifier, payload_count, and all payload bytes.</li>
<li>Reset both allocation counters to zero. </li>
</ol>

</div>
</div>
<a id="afd3358d37ab07ff0f8ec918c00fffe99" name="afd3358d37ab07ff0f8ec918c00fffe99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd3358d37ab07ff0f8ec918c00fffe99">&#9670;&#160;</a></span>CanBufferStore_allocate_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> * CanBufferStore_allocate_buffer </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocates one <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffer from the pool. </p>
<p>Finds the first free slot, clears it, marks it allocated, and updates the peak telemetry counter.</p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the allocated <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a>, or NULL if the pool is exhausted.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Returns NULL when pool is full - caller MUST check before use. </dd>
<dd>
NOT thread-safe.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="can__buffer__store_8c.html#ad95fb1127ec823f0cc9117848b78e5a7" title="Returns a can_msg_t buffer to the pool.">CanBufferStore_free_buffer</a></dd></dl>
<p>Algorithm:</p><ol type="1">
<li>Iterate through pool looking for first unallocated buffer.</li>
<li>When found: increment allocation counter, update peak counter if needed, clear the buffer, mark it allocated, and return pointer.</li>
<li>If no free buffer found, return NULL.</li>
</ol>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the allocated <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a>, or NULL if the pool is exhausted. </dd></dl>

</div>
</div>
<a id="ad95fb1127ec823f0cc9117848b78e5a7" name="ad95fb1127ec823f0cc9117848b78e5a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad95fb1127ec823f0cc9117848b78e5a7">&#9670;&#160;</a></span>CanBufferStore_free_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CanBufferStore_free_buffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> *</td>          <td class="paramname"><span class="paramname"><em>msg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns a <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffer to the pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Pointer to the buffer to free. NULL is safely ignored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Do not access the buffer after freeing. </dd>
<dd>
NOT thread-safe - use shared resource locking.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="can__buffer__store_8c.html#afd3358d37ab07ff0f8ec918c00fffe99" title="Allocates one can_msg_t buffer from the pool.">CanBufferStore_allocate_buffer</a></dd></dl>
<p>Algorithm:</p><ol type="1">
<li>If NULL pointer passed, return immediately.</li>
<li>Decrement allocation counter and clear the allocated flag.</li>
</ol>
<pre class="fragment">* @param msg Pointer to the buffer to free. NULL is safely ignored.
* </pre> 
</div>
</div>
<a id="a114ce74d1c445b6df687c6148d62d6c6" name="a114ce74d1c445b6df687c6148d62d6c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a114ce74d1c445b6df687c6148d62d6c6">&#9670;&#160;</a></span>CanBufferStore_messages_allocated()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t CanBufferStore_messages_allocated </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the number of <a class="el" href="can__types_8h.html#a9fec363f8b39411fc3ce3bafd7182309">can_msg_t</a> buffers currently allocated. </p>

</div>
</div>
<a id="a94cdc3572a78f32c7a31b632b741ff31" name="a94cdc3572a78f32c7a31b632b741ff31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94cdc3572a78f32c7a31b632b741ff31">&#9670;&#160;</a></span>CanBufferStore_messages_max_allocated()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t CanBufferStore_messages_max_allocated </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the peak allocation count since last reset. </p>

</div>
</div>
<a id="ab6eded9ea67c83dfe9fff89a79f36ad6" name="ab6eded9ea67c83dfe9fff89a79f36ad6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6eded9ea67c83dfe9fff89a79f36ad6">&#9670;&#160;</a></span>CanBufferStore_clear_max_allocated()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CanBufferStore_clear_max_allocated </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resets the peak counter without affecting current allocations. </p>

</div>
</div>
</div><!-- contents -->
<!doctype html>
<html>
    <body>
        <hr>
        <p style="margin-left: 10px; margin-right: 10px;">
            <b>Copyright (c)</b> 2026 Jim Kueneman all rights reserved. See the <a href="../licence.html">License</a>
        </p>
    </body>
</html>
